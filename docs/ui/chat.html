<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¹è¯æ¨¡å¼ - å¼€å£é¸­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .duck-avatar {
        position: relative;
        background: linear-gradient(45deg, #ffd700, #ffa500);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .duck-avatar::before {
        content: '';
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 25%;
        height: 20%;
        background: #ff6b35;
        border-radius: 0 0 50% 50%;
        clip-path: polygon(25% 0%, 75% 0%, 100% 100%, 0% 100%);
      }
      .duck-avatar::after {
        content: '';
        position: absolute;
        top: 45%;
        left: 30%;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #000;
        box-shadow: 12px 0 0 #000;
      }
      /* æ•´ä½“èƒŒæ™¯å’Œå¸ƒå±€ä¼˜åŒ– */
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .scroll-container {
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px 20px 0 0;
        margin: 0 8px;
      }
      .scroll-container::-webkit-scrollbar {
        width: 6px;
      }
      .scroll-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .scroll-container::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
      }
      .scroll-container::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      /* å¾®ä¿¡é£æ ¼çš„è¯­éŸ³æ¡æ ·å¼ */
      .voice-message-container {
        position: relative;
        max-width: 220px;
        display: flex;
        flex-direction: column;
      }

      .voice-message {
        position: relative;
        display: flex;
        align-items: center;
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 18px;
        padding: 8px 12px;
        min-width: 120px;
        max-width: 180px;
        height: 40px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: visible;
        z-index: 1;
        backdrop-filter: blur(10px);
      }

      .voice-message:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .voice-message:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .voice-message.sent {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      }

      .voice-message .play-btn {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        flex-shrink: 0;
      }

      .voice-message.sent .play-btn {
        background: rgba(255, 255, 255, 0.25);
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
      }

      .voice-message .play-btn:hover {
        transform: scale(1.1);
      }

      .voice-waves {
        display: flex;
        align-items: center;
        gap: 1px;
        margin-right: 8px;
        flex: 1;
        min-width: 0;
      }

      .wave-bar {
        width: 2px;
        background: #667eea;
        border-radius: 1px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .voice-message.sent .wave-bar {
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 1px 3px rgba(255, 255, 255, 0.3);
      }

      .wave-bar:nth-child(1) {
        height: 6px;
      }
      .wave-bar:nth-child(2) {
        height: 4px;
      }
      .wave-bar:nth-child(3) {
        height: 10px;
      }
      .wave-bar:nth-child(4) {
        height: 3px;
      }
      .wave-bar:nth-child(5) {
        height: 8px;
      }
      .wave-bar:nth-child(6) {
        height: 5px;
      }
      .wave-bar:nth-child(7) {
        height: 4px;
      }
      .wave-bar:nth-child(8) {
        height: 7px;
      }

      .voice-message.playing .wave-bar {
        animation: wave 1.5s ease-in-out infinite;
      }

      @keyframes wave {
        0%,
        100% {
          transform: scaleY(1);
        }
        50% {
          transform: scaleY(1.5);
        }
      }

      .voice-duration {
        font-size: 10px;
        font-weight: 600;
        color: #64748b;
        white-space: nowrap;
        letter-spacing: 0.3px;
        flex-shrink: 0;
      }

      .voice-message.sent .voice-duration {
        color: rgba(255, 255, 255, 0.95);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* è¯­éŸ³æ¶ˆæ¯æ“ä½œæŒ‰é’® */
      .voice-actions {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(15px);
        border-radius: 16px;
        padding: 10px 16px;
        display: none;
        z-index: 20;
        white-space: nowrap;
        pointer-events: none;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-bottom: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .voice-actions::before {
        content: '';
        position: absolute;
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 6px solid rgba(0, 0, 0, 0.8);
      }

      .voice-actions.show {
        display: flex;
        gap: 8px;
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        animation: slideDown 0.3s ease;
      }

      .voice-actions button {
        font-size: 12px;
        padding: 8px 14px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 6px;
        color: white;
        font-weight: 600;
        background: transparent;
        letter-spacing: 0.5px;
      }

      .voice-actions button:hover {
        transform: scale(1.08);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* è¯­éŸ³æ¶ˆæ¯å†…å®¹åŒºåŸŸ */
      .voice-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(15px);
        border-radius: 16px;
        padding: 12px 16px;
        margin-top: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        opacity: 0;
        transform: translateY(-10px);
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: none;
      }

      .voice-content.show {
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
        display: block;
      }

      /* è¯­éŸ³æ¡æœ¬èº«å³å¯¹é½ï¼Œä½†å†…å®¹åŒºåŸŸå·¦å¯¹é½ */
      .flex.justify-end .voice-message-container .voice-message {
        align-self: flex-end;
      }

      /* æ‰€æœ‰è¯­éŸ³å†…å®¹éƒ½å·¦å¯¹é½ï¼Œç¬¦åˆé˜…è¯»ä¹ æƒ¯ */
      .voice-content {
        text-align: left;
        align-self: stretch;
        margin-bottom: 6px;
      }

      /* ç¡®ä¿æ—¶é—´æˆ³ä¸è¢«è¦†ç›– */
      .voice-message-container p.text-xs {
        margin-top: 4px;
        margin-bottom: 0;
        position: relative;
        z-index: 1;
        clear: both;
        font-size: 11px;
        color: #64748b;
        font-weight: 500;
        letter-spacing: 0.3px;
        align-self: flex-start;
      }

      /* ç”¨æˆ·æ¶ˆæ¯å®¹å™¨ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ */
      .flex.justify-end .voice-message-container {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        margin-bottom: 0;
        min-height: 0;
        max-width: 220px;
      }

      /* ç”¨æˆ·æ¶ˆæ¯çš„æ—¶é—´æˆ³å³å¯¹é½ */
      .flex.justify-end .voice-message-container p.text-xs {
        align-self: flex-end;
      }

      .voice-text {
        font-size: 11px;
        color: #374151;
        line-height: 1.4;
        margin-bottom: 6px;
        font-style: italic;
      }

      .help-suggestion {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        border-radius: 8px;
        padding: 8px 12px;
        margin-top: 6px;
        font-size: 11px;
        color: #166534;
        line-height: 1.5;
      }

      /* æ±‚åŠ©æˆåŠŸæç¤º */
      .help-success {
        background: #dbeafe;
        border: 1px solid #93c5fd;
        border-radius: 8px;
        padding: 6px 10px;
        margin-top: 6px;
        font-size: 11px;
        color: #1e40af;
        display: none;
        font-weight: 500;
      }

      .help-success.show {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      /* ç¿»è¯‘ç»“æœæ ·å¼ */
      .translation-result {
        background: #fef3f2;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 6px 8px;
        margin-top: 4px;
        font-size: 10px;
        color: #dc2626;
        display: none;
      }

      .translation-result.show {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* è¯­éŸ³åŠŸèƒ½æŒ‰é’®å¢å¼º */
      .voice-actions button.translate-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .voice-actions button.help-btn {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(240, 147, 251, 0.3);
      }

      /* è¯¦ç»†åŠŸèƒ½é¢æ¿ */
      .detailed-content {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 12px;
        margin-top: 6px;
        font-size: 11px;
        display: none;
        line-height: 1.6;
      }

      .detailed-content.show {
        display: block;
        animation: slideDown 0.3s ease;
      }

      .detailed-content h4 {
        font-size: 12px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 6px;
        margin-top: 0;
      }

      .detailed-content p {
        margin: 4px 0;
        color: #4b5563;
      }

      .detailed-content ul {
        margin: 4px 0;
        padding-left: 16px;
      }

      .detailed-content li {
        margin: 2px 0;
        color: #4b5563;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
        }
        to {
          opacity: 1;
          max-height: 200px;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 h-screen overflow-hidden">
    <script src="auth.js"></script>
    <!-- iOSçŠ¶æ€æ  -->
    <div class="bg-white h-11 flex items-center justify-between px-4 text-sm font-medium">
      <div class="flex items-center space-x-1">
        <span>9:41</span>
      </div>
      <div class="w-16 h-4 bg-black rounded-full relative">
        <div class="absolute right-0 top-0 w-1 h-1 bg-white rounded-full m-1"></div>
      </div>
      <div class="flex items-center space-x-1">
        <i class="fas fa-signal text-xs"></i>
        <i class="fas fa-wifi text-xs"></i>
        <i class="fas fa-battery-three-quarters text-xs"></i>
      </div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <div
      class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-4 flex items-center shadow-lg"
    >
      <i
        class="fas fa-arrow-left text-xl mr-4 hover:opacity-80 transition-opacity cursor-pointer"
      ></i>
      <div class="flex items-center flex-1">
        <div
          class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-4 shadow-md"
        >
          <span class="text-xl">ğŸ‘©â€ğŸ«</span>
        </div>
        <div>
          <h2 class="font-bold text-lg">Emma (AIå¤–æ•™)</h2>
          <p class="text-sm opacity-90 flex items-center">
            <span class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></span>
            åœ¨çº¿
          </p>
        </div>
      </div>
    </div>

    <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
    <div class="flex-1 px-4 py-4 space-y-4 scroll-container" style="height: calc(100vh - 200px)">
      <!-- AIæ¶ˆæ¯ -->
      <div class="flex items-start space-x-3">
        <div
          class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0"
        >
          <span class="text-white text-lg">ğŸ‘©â€ğŸ«</span>
        </div>
        <div class="flex-1 max-w-xs">
          <!-- è¯­éŸ³æ¶ˆæ¯ -->
          <div class="voice-message-container">
            <div
              class="voice-message"
              onclick="playVoice(this)"
              oncontextmenu="showVoiceActions(event, this, 'ai')"
              onmousedown="startLongPress(this)"
              onmouseup="endLongPress(this)"
              onmouseleave="endLongPress(this)"
            >
              <div class="play-btn">
                <i class="fas fa-play text-blue-500 text-xs"></i>
              </div>
              <div class="voice-waves">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span class="voice-duration">5"</span>

              <!-- é•¿æŒ‰æ˜¾ç¤ºçš„æŒ‰é’® -->
              <div class="voice-actions" id="actions-ai-msg-1">
                <button class="translate-btn" onclick="showTranslation('ai-msg-1')">
                  <i class="fas fa-language"></i>ç¿»è¯‘
                </button>
              </div>
            </div>
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="voice-content" id="content-ai-msg-1">
              <div class="voice-text">"Hi! How are you doing today?"</div>
              <!-- ç¿»è¯‘ç»“æœ -->
              <div class="translation-result" id="trans-ai-msg-1">
                <div><strong>ç¿»è¯‘:</strong> "å—¨ï¼ä½ ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ"</div>
              </div>
              <!-- è¯¦ç»†å†…å®¹ -->
              <div class="detailed-content" id="detail-ai-msg-1">
                <h4>ğŸ“– è¯­æ³•è§£æ</h4>
                <ul>
                  <li><strong>"How are you doing"</strong> - ç°åœ¨è¿›è¡Œæ—¶çš„é—®å€™æ–¹å¼</li>
                  <li><strong>"today"</strong> - æ—¶é—´çŠ¶è¯­ï¼Œè¯¢é—®ä»Šå¤©çš„æƒ…å†µ</li>
                </ul>

                <h4>ğŸ”„ ç›¸ä¼¼è¡¨è¾¾</h4>
                <ul>
                  <li>"How's your day going?"</li>
                  <li>"How has your day been?"</li>
                </ul>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">åˆšåˆš</p>
          </div>
        </div>
      </div>

      <!-- ç”¨æˆ·æ¶ˆæ¯ -->
      <div class="flex items-start space-x-3 justify-end">
        <div class="flex-1 flex justify-end max-w-xs">
          <div class="voice-message-container">
            <div
              class="voice-message sent"
              onclick="playVoice(this)"
              oncontextmenu="showVoiceActions(event, this, 'user')"
              onmousedown="startLongPress(this)"
              onmouseup="endLongPress(this)"
              onmouseleave="endLongPress(this)"
            >
              <div class="play-btn">
                <i class="fas fa-play text-white text-xs"></i>
              </div>
              <div class="voice-waves">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span class="voice-duration">3"</span>

              <!-- é•¿æŒ‰æ˜¾ç¤ºçš„æŒ‰é’® -->
              <div class="voice-actions" id="actions-user-msg-1">
                <button class="translate-btn" onclick="showTranslation('user-msg-1')">
                  <i class="fas fa-language"></i>ç¿»è¯‘
                </button>
                <button class="help-btn" onclick="handleHelpRequest('user-msg-1')">
                  <i class="fas fa-question-circle"></i>æ±‚åŠ©
                </button>
              </div>
            </div>
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="voice-content" id="content-user-msg-1">
              <div class="voice-text">"æˆ‘å¾ˆå¥½ï¼Œè°¢è°¢"</div>
              <!-- ç¿»è¯‘ç»“æœ -->
              <div class="translation-result" id="trans-user-msg-1">
                <div><strong>ç¿»è¯‘:</strong> "I'm fine, thank you"</div>
              </div>
              <!-- æ±‚åŠ©æˆåŠŸæç¤º -->
              <div class="help-success" id="success-user-msg-1">
                <strong>âœ… æ±‚åŠ©æˆåŠŸï¼</strong> å·²ä¸ºæ‚¨æä¾›åœ°é“è¡¨è¾¾å»ºè®®ï¼Œå‰©ä½™æ¬¡æ•°:
                <span id="remaining-user-msg-1">2</span>
              </div>
              <!-- åœ°é“è¡¨è¾¾å»ºè®® -->
              <div class="help-suggestion" id="help-user-msg-1" style="display: none">
                <h4>ğŸ’¡ åœ°é“è¡¨è¾¾å»ºè®®</h4>
                <p><strong>æ¨èè¡¨è¾¾:</strong> "I'm doing great, thanks!"</p>
                <p><strong>æ”¹è¿›åŸå› :</strong></p>
                <ul>
                  <li>"doing great" æ¯” "fine" æ›´ç§¯æè‡ªç„¶</li>
                  <li>"thanks" æ¯” "thank you" æ›´å£è¯­åŒ–</li>
                </ul>
              </div>
              <!-- è¯¦ç»†æ±‚åŠ©å†…å®¹ -->
              <div class="detailed-content" id="detail-user-msg-1">
                <div class="flex items-center justify-between mb-3">
                  <h4>ğŸ¯ å‘éŸ³è¦ç‚¹</h4>
                  <button
                    class="bg-blue-500 text-white px-3 py-1 rounded text-xs"
                    onclick="playHelpContent('user-msg-1')"
                  >
                    <i class="fas fa-volume-up mr-1"></i>æ’­æ”¾
                  </button>
                </div>
                <ul>
                  <li><strong>"I'm"</strong> /aÉªm/ - æ³¨æ„è¿è¯»å‘éŸ³</li>
                  <li><strong>"doing"</strong> /ËˆduËÉªÅ‹/ - é‡éŸ³åœ¨ç¬¬ä¸€ä¸ªéŸ³èŠ‚</li>
                </ul>

                <h4>ğŸ“ è¡¨è¾¾å¯¹æ¯”</h4>
                <ul>
                  <li><strong>ä½ çš„è¡¨è¾¾:</strong> "I'm fine" (æ­£ç¡®ä½†è¾ƒæ­£å¼)</li>
                  <li><strong>åœ°é“è¡¨è¾¾:</strong> "I'm doing great" (æ›´è‡ªç„¶ç§¯æ)</li>
                </ul>

                <h4>ğŸ­ ä½¿ç”¨åœºæ™¯</h4>
                <ul>
                  <li><strong>æœ‹å‹é—´:</strong> "I'm doing great!"</li>
                  <li><strong>æ­£å¼åœºåˆ:</strong> "I'm very well, thank you"</li>
                </ul>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">åˆšåˆš</p>
          </div>
        </div>
        <div class="w-10 h-10 duck-avatar flex-shrink-0"></div>
      </div>

      <!-- å¦ä¸€æ¡AIæ¶ˆæ¯ -->
      <div class="flex items-start space-x-3">
        <div
          class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0"
        >
          <span class="text-white text-lg">ğŸ‘©â€ğŸ«</span>
        </div>
        <div class="flex-1 max-w-xs">
          <div class="voice-message-container">
            <div
              class="voice-message"
              onclick="playVoice(this)"
              oncontextmenu="showVoiceActions(event, this, 'ai')"
              onmousedown="startLongPress(this)"
              onmouseup="endLongPress(this)"
              onmouseleave="endLongPress(this)"
            >
              <div class="play-btn">
                <i class="fas fa-play text-blue-500 text-xs"></i>
              </div>
              <div class="voice-waves">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span class="voice-duration">6"</span>

              <!-- é•¿æŒ‰æ˜¾ç¤ºçš„æŒ‰é’® -->
              <div class="voice-actions" id="actions-ai-msg-2">
                <button class="translate-btn" onclick="showTranslation('ai-msg-2')">
                  <i class="fas fa-language"></i>ç¿»è¯‘
                </button>
              </div>
            </div>
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="voice-content" id="content-ai-msg-2">
              <div class="voice-text">"What about your weekend plans?"</div>
              <!-- ç¿»è¯‘ç»“æœ -->
              <div class="translation-result" id="trans-ai-msg-2">
                <div><strong>ç¿»è¯‘:</strong> "ä½ çš„å‘¨æœ«è®¡åˆ’æ€ä¹ˆæ ·ï¼Ÿ"</div>
              </div>
              <!-- è¯¦ç»†å†…å®¹ -->
              <div class="detailed-content" id="detail-ai-msg-2">
                <h4>ğŸ“– è¯­æ³•è§£æ</h4>
                <ul>
                  <li><strong>"What about"</strong> - è¯¢é—®æŸäº‹çš„å¸¸ç”¨å¥å‹</li>
                  <li><strong>"weekend plans"</strong> - å¤æ•°åè¯çŸ­è¯­</li>
                </ul>

                <h4>ğŸ”„ ç›¸ä¼¼è¡¨è¾¾</h4>
                <ul>
                  <li>"Do you have any weekend plans?"</li>
                  <li>"What are you doing this weekend?"</li>
                </ul>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">åˆšåˆš</p>
          </div>
        </div>
      </div>

      <!-- æ›´å¤šæ¶ˆæ¯ç¤ºä¾‹ -->
      <div class="flex items-start space-x-3 justify-end">
        <div class="flex-1 flex justify-end max-w-xs">
          <div class="voice-message-container">
            <div
              class="voice-message sent"
              onclick="playVoice(this)"
              oncontextmenu="showVoiceActions(event, this, 'user')"
              onmousedown="startLongPress(this)"
              onmouseup="endLongPress(this)"
              onmouseleave="endLongPress(this)"
            >
              <div class="play-btn">
                <i class="fas fa-play text-white text-xs"></i>
              </div>
              <div class="voice-waves">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span class="voice-duration">4"</span>

              <!-- é•¿æŒ‰æ˜¾ç¤ºçš„æŒ‰é’® -->
              <div class="voice-actions" id="actions-user-msg-2">
                <button class="translate-btn" onclick="showTranslation('user-msg-2')">
                  <i class="fas fa-language"></i>ç¿»è¯‘
                </button>
                <button class="help-btn" onclick="handleHelpRequest('user-msg-2')">
                  <i class="fas fa-question-circle"></i>æ±‚åŠ©
                </button>
              </div>
            </div>
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="voice-content" id="content-user-msg-2">
              <div class="voice-text">"è®¡åˆ’å»å…¬å›­æ•£æ­¥"</div>
              <!-- ç¿»è¯‘ç»“æœ -->
              <div class="translation-result" id="trans-user-msg-2">
                <div><strong>ç¿»è¯‘:</strong> "I plan to take a walk in the park"</div>
              </div>
              <!-- æ±‚åŠ©æˆåŠŸæç¤º -->
              <div class="help-success" id="success-user-msg-2">
                <strong>âœ… æ±‚åŠ©æˆåŠŸï¼</strong> å·²ä¸ºæ‚¨æä¾›åœ°é“è¡¨è¾¾å»ºè®®ï¼Œå‰©ä½™æ¬¡æ•°:
                <span id="remaining-user-msg-2">2</span>
              </div>
              <!-- åœ°é“è¡¨è¾¾å»ºè®® -->
              <div class="help-suggestion" id="help-user-msg-2" style="display: none">
                <h4>ğŸ’¡ åœ°é“è¡¨è¾¾å»ºè®®</h4>
                <p><strong>æ¨èè¡¨è¾¾:</strong> "I'm planning to go for a walk in the park"</p>
                <p><strong>æ”¹è¿›åŸå› :</strong></p>
                <ul>
                  <li>"go for a walk" æ¯” "take a walk" æ›´è‡ªç„¶åœ°é“</li>
                  <li>"planning" æ¯” "plan" æ›´å£è¯­åŒ–</li>
                </ul>
              </div>
              <!-- è¯¦ç»†æ±‚åŠ©å†…å®¹ -->
              <div class="detailed-content" id="detail-user-msg-2">
                <div class="flex items-center justify-between mb-3">
                  <h4>ğŸ¯ å‘éŸ³è¦ç‚¹</h4>
                  <button
                    class="bg-blue-500 text-white px-3 py-1 rounded text-xs"
                    onclick="playHelpContent('user-msg-2')"
                  >
                    <i class="fas fa-volume-up mr-1"></i>æ’­æ”¾
                  </button>
                </div>
                <ul>
                  <li><strong>"planning"</strong> /ËˆplÃ¦nÉªÅ‹/ - æ³¨æ„åŒnçš„å‘éŸ³</li>
                  <li><strong>"walk"</strong> /wÉ”Ëk/ - é•¿éŸ³o</li>
                </ul>

                <h4>ğŸ“ è¡¨è¾¾å¯¹æ¯”</h4>
                <ul>
                  <li><strong>ä½ çš„è¡¨è¾¾:</strong> "plan to take a walk"</li>
                  <li><strong>æ›´åœ°é“:</strong> "planning to go for a walk"</li>
                </ul>

                <h4>ğŸ“š è¯æ±‡æ‰©å±•</h4>
                <ul>
                  <li><strong>go for a stroll</strong> (æ‚ é—²æ•£æ­¥)</li>
                  <li><strong>take a hike</strong> (å¾’æ­¥)</li>
                </ul>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">1åˆ†é’Ÿå‰</p>
          </div>
        </div>
        <div class="w-10 h-10 duck-avatar flex-shrink-0"></div>
      </div>

      <div class="flex items-start space-x-3">
        <div
          class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0"
        >
          <span class="text-white text-lg">ğŸ‘©â€ğŸ«</span>
        </div>
        <div class="flex-1 max-w-xs">
          <div class="voice-message-container">
            <div
              class="voice-message"
              onclick="playVoice(this)"
              oncontextmenu="showVoiceActions(event, this, 'ai')"
              onmousedown="startLongPress(this)"
              onmouseup="endLongPress(this)"
              onmouseleave="endLongPress(this)"
            >
              <div class="play-btn">
                <i class="fas fa-play text-blue-500 text-xs"></i>
              </div>
              <div class="voice-waves">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span class="voice-duration">8"</span>

              <!-- é•¿æŒ‰æ˜¾ç¤ºçš„æŒ‰é’® -->
              <div class="voice-actions" id="actions-ai-msg-3">
                <button class="translate-btn" onclick="showTranslation('ai-msg-3')">
                  <i class="fas fa-language"></i>ç¿»è¯‘
                </button>
              </div>
            </div>
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="voice-content" id="content-ai-msg-3">
              <div class="voice-text">
                "That sounds lovely! Walking in the park is a great way to relax."
              </div>
              <!-- ç¿»è¯‘ç»“æœ -->
              <div class="translation-result" id="trans-ai-msg-3">
                <div><strong>ç¿»è¯‘:</strong> "å¬èµ·æ¥å¾ˆæ£’ï¼åœ¨å…¬å›­æ•£æ­¥æ˜¯æ”¾æ¾çš„å¥½æ–¹æ³•ã€‚"</div>
              </div>
              <!-- è¯¦ç»†å†…å®¹ -->
              <div class="detailed-content" id="detail-ai-msg-3">
                <h4>ğŸ“– è¯­æ³•è§£æ</h4>
                <ul>
                  <li><strong>"That sounds lovely"</strong> - è¡¨è¾¾èµåŒçš„å¸¸ç”¨å¥å‹</li>
                  <li><strong>"a great way to..."</strong> - è¡¨ç¤ºæ–¹æ³•çš„å¥å‹</li>
                </ul>

                <h4>ğŸ’¡ åœ°é“è¡¨è¾¾å­¦ä¹ </h4>
                <ul>
                  <li><strong>"sounds lovely"</strong> = "sounds great/wonderful"</li>
                  <li><strong>"a great way to relax"</strong> - åœ°é“çš„è¡¨è¾¾æ–¹å¼</li>
                </ul>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">1åˆ†é’Ÿå‰</p>
          </div>
        </div>
      </div>
    </div>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="bg-white px-4 py-4 border-t border-gray-200 shadow-lg">
      <div class="flex items-center justify-center space-x-4">
        <i
          class="fas fa-plus-circle text-gray-500 text-xl hover:text-blue-500 transition-colors cursor-pointer"
        ></i>

        <!-- æŒ‰ä½è¯´è¯æŒ‰é’® -->
        <div class="flex justify-center">
          <button
            class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-10 py-2 rounded-full flex items-center space-x-3 active:from-blue-600 active:to-purple-700 transform active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl"
          >
            <i class="fas fa-microphone text-xl"></i>
            <span class="font-semibold text-lg">æŒ‰ä½è¯´è¯</span>
          </button>
        </div>

        <i
          class="fas fa-smile text-gray-500 text-xl hover:text-blue-500 transition-colors cursor-pointer"
        ></i>
      </div>

      <!-- å½•éŸ³çŠ¶æ€æç¤º -->
      <div class="hidden mt-3 text-center">
        <div
          class="bg-red-500 text-white px-4 py-2 rounded-full inline-flex items-center space-x-2"
        >
          <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
          <span>æ­£åœ¨å½•éŸ³...</span>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="bg-white border-t border-gray-200 shadow-lg">
      <div class="flex justify-around items-center py-3 px-4">
        <div
          class="flex flex-col items-center py-2 hover:text-blue-500 transition-colors cursor-pointer"
          onclick="window.location.href='home.html'"
        >
          <i class="fas fa-home text-gray-500 text-xl hover:text-blue-500 transition-colors"></i>
          <span class="text-xs text-gray-500 mt-1 font-medium">é¦–é¡µ</span>
        </div>
        <div
          class="flex flex-col items-center py-2 hover:text-blue-500 transition-colors cursor-pointer"
          onclick="window.location.href='progress.html'"
        >
          <i
            class="fas fa-chart-line text-gray-500 text-xl hover:text-blue-500 transition-colors"
          ></i>
          <span class="text-xs text-gray-500 mt-1 font-medium">è¿›åº¦</span>
        </div>
        <div
          class="flex flex-col items-center py-2 hover:text-blue-500 transition-colors cursor-pointer"
          onclick="window.location.href='profile.html'"
        >
          <i class="fas fa-user text-gray-500 text-xl hover:text-blue-500 transition-colors"></i>
          <span class="text-xs text-gray-500 mt-1 font-medium">æˆ‘çš„</span>
        </div>
      </div>
    </div>

    <script>
      function playVoice(element) {
        // ç§»é™¤å…¶ä»–æ’­æ”¾çŠ¶æ€
        document.querySelectorAll('.voice-message').forEach((msg) => {
          msg.classList.remove('playing')
          const playBtn = msg.querySelector('.play-btn i')
          playBtn.className = playBtn.className.includes('sent')
            ? 'fas fa-play text-white text-xs'
            : 'fas fa-play text-blue-500 text-xs'
        })

        // åˆ‡æ¢å½“å‰æ’­æ”¾çŠ¶æ€
        const isPlaying = element.classList.contains('playing')
        const playBtn = element.querySelector('.play-btn i')

        if (!isPlaying) {
          element.classList.add('playing')
          playBtn.className = playBtn.className.includes('text-white')
            ? 'fas fa-pause text-white text-xs'
            : 'fas fa-pause text-blue-500 text-xs'

          // æ¨¡æ‹Ÿæ’­æ”¾æ—¶é•¿
          const duration = parseInt(element.querySelector('.voice-duration').textContent) * 1000
          setTimeout(() => {
            element.classList.remove('playing')
            playBtn.className = playBtn.className.includes('text-white')
              ? 'fas fa-play text-white text-xs'
              : 'fas fa-play text-blue-500 text-xs'
          }, duration)
        } else {
          element.classList.remove('playing')
          playBtn.className = playBtn.className.includes('text-white')
            ? 'fas fa-play text-white text-xs'
            : 'fas fa-play text-blue-500 text-xs'
        }
      }

      // é•¿æŒ‰ç›¸å…³å˜é‡
      let longPressTimer = null
      let longPressDelay = 500 // 500msé•¿æŒ‰è§¦å‘

      // å¼€å§‹é•¿æŒ‰
      function startLongPress(element) {
        console.log('å¼€å§‹é•¿æŒ‰')
        longPressTimer = setTimeout(() => {
          console.log('é•¿æŒ‰è§¦å‘')
          showVoiceActions(null, element, element.classList.contains('sent') ? 'user' : 'ai')
        }, longPressDelay)
      }

      // ç»“æŸé•¿æŒ‰
      function endLongPress(element) {
        if (longPressTimer) {
          console.log('ç»“æŸé•¿æŒ‰')
          clearTimeout(longPressTimer)
          longPressTimer = null
        }
      }

      // é˜»æ­¢å³é”®èœå•
      document.addEventListener('contextmenu', function (e) {
        e.preventDefault()
      })

      // é¡µé¢åŠ è½½æ—¶ç¡®ä¿æ‰€æœ‰æŒ‰é’®éƒ½æ˜¯éšè—çš„
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.voice-actions').forEach((actions) => {
          actions.classList.remove('show')
        })
      })

      // æ˜¾ç¤ºè¯­éŸ³æ“ä½œæŒ‰é’®
      function showVoiceActions(event, element, type) {
        if (event) {
          event.preventDefault()
        }

        console.log('æ˜¾ç¤ºæŒ‰é’®:', type)

        // éšè—æ‰€æœ‰å…¶ä»–æŒ‰é’®
        document.querySelectorAll('.voice-actions').forEach((actions) => {
          actions.classList.remove('show')
        })

        // æ˜¾ç¤ºå½“å‰æŒ‰é’®
        const actionsId = element.querySelector('.voice-actions').id
        const actions = document.getElementById(actionsId)
        if (actions) {
          actions.classList.add('show')
          console.log('æŒ‰é’®å·²æ˜¾ç¤º:', actionsId)

          // 3ç§’åè‡ªåŠ¨éšè—
          setTimeout(() => {
            actions.classList.remove('show')
            console.log('æŒ‰é’®å·²éšè—:', actionsId)
          }, 3000)
        }
      }

      // æ˜¾ç¤º/éšè—ç¿»è¯‘ç»“æœ
      function showTranslation(msgId) {
        const contentDiv = document.getElementById(`content-${msgId}`)
        const translationDiv = document.getElementById(`trans-${msgId}`)
        const detailDiv = document.getElementById(`detail-${msgId}`)

        // éšè—æ‰€æœ‰å†…å®¹
        document.querySelectorAll('.voice-content').forEach((content) => {
          content.classList.remove('show')
        })

        // æ˜¾ç¤ºå½“å‰å†…å®¹
        contentDiv.classList.add('show')
        translationDiv.classList.add('show')
        detailDiv.classList.add('show')

        // éšè—æŒ‰é’®
        document.getElementById(`actions-${msgId}`).classList.remove('show')
      }

      // å¤„ç†æ±‚åŠ©è¯·æ±‚ï¼ˆå¢å¼ºç‰ˆï¼‰
      function handleHelpRequest(msgId) {
        const usage = checkUsage('help')
        if (usage.canUse) {
          incrementUsage('help')
          const remaining = isMember() ? 'âˆ' : usage.remaining - 1

          // æ˜¾ç¤ºå†…å®¹åŒºåŸŸ
          const contentDiv = document.getElementById(`content-${msgId}`)
          const helpDiv = document.getElementById(`help-${msgId}`)
          const detailDiv = document.getElementById(`detail-${msgId}`)
          const successDiv = document.getElementById(`success-${msgId}`)
          const remainingSpan = document.getElementById(`remaining-${msgId}`)

          // éšè—æ‰€æœ‰å†…å®¹
          document.querySelectorAll('.voice-content').forEach((content) => {
            content.classList.remove('show')
          })

          // æ˜¾ç¤ºå½“å‰å†…å®¹
          contentDiv.classList.add('show')

          if (helpDiv) {
            helpDiv.style.display = 'block'
            helpDiv.classList.add('show')
          }

          if (detailDiv) {
            detailDiv.classList.add('show')
          }

          // æ˜¾ç¤ºæ±‚åŠ©æˆåŠŸæç¤º
          if (successDiv) {
            successDiv.classList.add('show')
            if (remainingSpan) {
              remainingSpan.textContent = remaining
            }
          }

          // éšè—æŒ‰é’®
          document.getElementById(`actions-${msgId}`).classList.remove('show')

          // æ›´æ–°ä½¿ç”¨çŠ¶æ€æ˜¾ç¤º
          updateUsageDisplay()
        } else {
          showMembershipPrompt('ä»Šæ—¥æ±‚åŠ©æ¬¡æ•°å·²ç”¨å®Œã€‚')
        }
      }

      // æ’­æ”¾æ±‚åŠ©å†…å®¹è¯­éŸ³
      function playHelpContent(msgId) {
        const helpDiv = document.getElementById(`help-${msgId}`)
        const detailDiv = document.getElementById(`detail-${msgId}`)

        // æ˜¾ç¤ºå†…å®¹
        const contentDiv = document.getElementById(`content-${msgId}`)
        contentDiv.classList.add('show')

        if (helpDiv) {
          helpDiv.style.display = 'block'
          helpDiv.classList.add('show')
        }

        if (detailDiv) {
          detailDiv.classList.add('show')
        }

        // æ¨¡æ‹ŸTTSæ’­æ”¾
        console.log(`æ’­æ”¾æ±‚åŠ©å†…å®¹: ${msgId}`)

        // è¿™é‡Œå¯ä»¥é›†æˆçœŸå®çš„TTS API
        // æ’­æ”¾åœ°é“è¡¨è¾¾å»ºè®®
        setTimeout(() => {
          console.log('æ’­æ”¾: "I\'m doing great, thanks!"')
        }, 1000)

        // æ’­æ”¾è¯¦ç»†è§£é‡Š
        setTimeout(() => {
          console.log('æ’­æ”¾: "å‘éŸ³è¦ç‚¹å’Œè¯­æ³•å¯¹æ¯”"')
        }, 3000)
      }

      function updateUsageDisplay() {
        // æ›´æ–°é¡µé¢ä¸Šçš„ä½¿ç”¨æ¬¡æ•°æ˜¾ç¤º
        const userState = getUserState()
        const remaining = isMember() ? 'âˆ' : Math.max(0, 3 - (userState.dailyUsage.help || 0))

        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é¡µé¢å†…çš„ä½¿ç”¨æ¬¡æ•°æ˜¾ç¤ºæ›´æ–°
        console.log(`å‰©ä½™æ±‚åŠ©æ¬¡æ•°: ${remaining}`)
      }
    </script>
  </body>
</html>
