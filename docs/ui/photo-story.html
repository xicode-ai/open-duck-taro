<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‹ç…§çŸ­æ–‡ - å¼€å£é¸­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .scroll-container {
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #cbd5e0 #f7fafc;
      }
      .scroll-container::-webkit-scrollbar {
        width: 4px;
      }
      .scroll-container::-webkit-scrollbar-track {
        background: #f7fafc;
      }
      .scroll-container::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 2px;
      }
    </style>
  </head>
  <body class="bg-gray-50 h-screen overflow-hidden">
    <script src="auth.js"></script>
    <!-- iOSçŠ¶æ€æ  -->
    <div class="bg-white h-11 flex items-center justify-between px-4 text-sm font-medium">
      <div class="flex items-center space-x-1">
        <span>9:41</span>
      </div>
      <div class="w-16 h-4 bg-black rounded-full relative">
        <div class="absolute right-0 top-0 w-1 h-1 bg-white rounded-full m-1"></div>
      </div>
      <div class="flex items-center space-x-1">
        <i class="fas fa-signal text-xs"></i>
        <i class="fas fa-wifi text-xs"></i>
        <i class="fas fa-battery-three-quarters text-xs"></i>
      </div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <div class="bg-orange-500 text-white px-4 py-3 flex items-center">
      <i class="fas fa-arrow-left text-xl mr-4"></i>
      <h2 class="text-lg font-semibold flex-1">æ‹ç…§çŸ­æ–‡</h2>
      <button onclick="window.location.href='photo-story-history.html'" class="text-xl">
        <i class="fas fa-history"></i>
      </button>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="px-4 pt-6 pb-20 h-full scroll-container">
      <!-- æ‹ç…§åŒºåŸŸ -->
      <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
        <div
          class="aspect-square bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl relative overflow-hidden"
        >
          <!-- ç¤ºä¾‹å›¾ç‰‡ -->
          <img
            src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=400&fit=crop&crop=center"
            alt="Coffee shop scene"
            class="w-full h-full object-cover"
          />

          <!-- æ‹ç…§æŒ‰é’® -->
          <div class="absolute top-3 right-3">
            <button onclick="showActionSheet()" class="bg-white bg-opacity-90 text-gray-700 p-2 rounded-full shadow-sm hover:bg-white transition-colors">
              <i class="fas fa-camera text-sm"></i>
            </button>
          </div>

          <!-- æ‹ç…§æç¤ºï¼ˆåˆå§‹çŠ¶æ€ï¼‰ -->
          <div
            class="hidden absolute inset-0 flex flex-col items-center justify-center text-center p-6"
          >
            <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mb-4">
              <i class="fas fa-camera text-white text-2xl"></i>
            </div>
            <h3 class="text-gray-800 font-semibold mb-2">æ‹ä¸€å¼ ç…§ç‰‡</h3>
            <p class="text-gray-600 text-sm mb-4">AIå°†ä¸ºä½ ç”Ÿæˆè‹±æ–‡æè¿°</p>
            <button class="bg-orange-500 text-white px-6 py-3 rounded-full font-medium">
              <i class="fas fa-camera mr-2"></i>å¼€å§‹æ‹ç…§
            </button>
          </div>
        </div>

        <div class="flex justify-center mt-6">
          <button
            class="bg-orange-500 text-white px-8 py-3 rounded-xl font-medium text-lg shadow-sm hover:bg-orange-600 transition-colors"
            onclick="handleGenerateStory()"
          >
            <i class="fas fa-magic mr-2"></i>ç”Ÿæˆæè¿°
          </button>
        </div>
      </div>

      <!-- æ ‡å‡†çŸ­æ–‡ -->
      <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
        <div class="flex items-center space-x-2 mb-4">
          <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-graduation-cap text-blue-500"></i>
          </div>
          <span class="font-semibold text-gray-800">æ ‡å‡†çŸ­æ–‡</span>
          <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs">Standard</span>
        </div>

        <div class="bg-blue-50 rounded-lg p-4 mb-4 relative" ontouchstart="handleLongPress(event, 'standard')" ontouchend="clearLongPress()">
          <p class="text-gray-800 leading-relaxed text-sm" id="standardText">
            "This is a cozy coffee shop with warm lighting and comfortable seating. There are
            several customers enjoying their drinks while working on laptops or chatting with
            friends. The barista behind the counter is preparing fresh coffee, and the aroma fills
            the entire space. Large windows let in natural light, creating a welcoming atmosphere
            perfect for relaxation or productivity."
          </p>
        </div>

        <div class="flex items-center justify-between">
          <div class="flex space-x-2">
            <button class="bg-blue-100 text-blue-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="playAudio('standard')">
              <i class="fas fa-play mr-1"></i>æ’­æ”¾
            </button>
            <button class="bg-blue-100 text-blue-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="startFollowReading('standard')">
              <i class="fas fa-microphone mr-1"></i>è·Ÿè¯»
            </button>
          </div>
          <button class="bg-red-100 text-red-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="toggleFavorite('standard')" id="favoriteBtn-standard">
            <i class="far fa-heart mr-1"></i>æ”¶è—
          </button>
        </div>

        <div class="text-center text-gray-500 text-xs mt-2">è¯æ±‡éš¾åº¦: ä¸­çº§ | é¢„è®¡æ—¶é•¿: 15ç§’</div>
      </div>

      <!-- åœ°é“çŸ­æ–‡ -->
      <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
        <div class="flex items-center space-x-2 mb-4">
          <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-comments text-green-500"></i>
          </div>
          <span class="font-semibold text-gray-800">åœ°é“çŸ­æ–‡</span>
          <span class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs">Native</span>
        </div>

        <div class="bg-green-50 rounded-lg p-4 mb-4 relative" ontouchstart="handleLongPress(event, 'native')" ontouchend="clearLongPress()">
          <p class="text-gray-800 leading-relaxed text-sm" id="nativeText">
            "What a lovely little cafÃ©! The vibe here is so chill with all these soft lights and comfy chairs.
            You've got people scattered around - some folks tapping away on their laptops, others just hanging out
            and catching up over coffee. The barista's working his magic behind the counter, and man, that coffee
            smell is incredible! Those big windows really brighten up the place - it's the perfect spot to either
            get some work done or just kick back and relax."
          </p>
        </div>

        <div class="flex items-center justify-between">
          <div class="flex space-x-2">
            <button class="bg-green-100 text-green-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="playAudio('native')">
              <i class="fas fa-play mr-1"></i>æ’­æ”¾
            </button>
            <button class="bg-green-100 text-green-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="startFollowReading('native')">
              <i class="fas fa-microphone mr-1"></i>è·Ÿè¯»
            </button>
          </div>
          <button class="bg-red-100 text-red-600 px-3 py-2 rounded-lg text-sm flex items-center" onclick="toggleFavorite('native')" id="favoriteBtn-native">
            <i class="far fa-heart mr-1"></i>æ”¶è—
          </button>
        </div>

        <div class="text-center text-gray-500 text-xs mt-2">è¯æ±‡éš¾åº¦: åˆä¸­çº§ | é¢„è®¡æ—¶é•¿: 18ç§’</div>
      </div>

      <!-- è·Ÿè¯»ç»ƒä¹ åŒºåŸŸ -->
      <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
        <div class="flex items-center space-x-2 mb-4">
          <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-microphone text-green-500"></i>
          </div>
          <span class="font-semibold text-gray-800">è·Ÿè¯»ç»ƒä¹ </span>
        </div>

        <!-- å¥å­åˆ†æ®µç»ƒä¹  -->
        <div class="space-y-3 mb-4">
          <div class="border border-green-200 rounded-lg p-3 bg-green-50">
            <div class="flex items-center justify-between mb-2">
              <span class="text-green-700 font-medium text-sm">å¥å­ 1/4</span>
              <button class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs">
                <i class="fas fa-play mr-1"></i>æ’­æ”¾
              </button>
            </div>
            <p class="text-gray-800 text-sm mb-2">
              "This is a cozy coffee shop with warm lighting and comfortable seating."
            </p>
            <div class="flex items-center space-x-2">
              <button class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm flex-1">
                <i class="fas fa-microphone mr-1"></i>å¼€å§‹è·Ÿè¯»
              </button>
              <div class="flex items-center space-x-1">
                <i class="fas fa-star text-yellow-400"></i>
                <span class="text-green-600 font-medium text-sm">88åˆ†</span>
              </div>
            </div>
          </div>

          <div class="border border-gray-200 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-gray-600 font-medium text-sm">å¥å­ 2/4</span>
              <button class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
                <i class="fas fa-play mr-1"></i>æ’­æ”¾
              </button>
            </div>
            <p class="text-gray-600 text-sm mb-2">
              "There are several customers enjoying their drinks while working on laptops..."
            </p>
            <button class="bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-sm w-full">
              <i class="fas fa-lock mr-1"></i>å®Œæˆä¸Šä¸€å¥è§£é”
            </button>
          </div>
        </div>

        <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
          <div class="flex items-center space-x-2 mb-2">
            <i class="fas fa-lightbulb text-yellow-500"></i>
            <span class="text-yellow-700 font-medium text-sm">å‘éŸ³æç¤º</span>
          </div>
          <p class="text-yellow-600 text-sm">
            æ³¨æ„ "comfortable" çš„å‘éŸ³: /ËˆkÊŒmftÉ™bl/ï¼Œé‡éŸ³åœ¨ç¬¬ä¸€ä¸ªéŸ³èŠ‚
          </p>
        </div>
      </div>

      <!-- æ•´ä½“è¯„åˆ† -->
      <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-6">
        <div class="flex items-center space-x-2 mb-4">
          <i class="fas fa-trophy text-yellow-500 text-lg"></i>
          <span class="font-semibold text-gray-800">ç»ƒä¹ æˆæœ</span>
        </div>

        <div class="text-center mb-4">
          <div
            class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3"
          >
            <span class="text-2xl font-bold text-green-600">B+</span>
          </div>
          <h3 class="text-lg font-semibold text-gray-800 mb-1">æ€»ä½“è¯„åˆ†: 85åˆ†</h3>
          <p class="text-gray-600 text-sm">å‘éŸ³æ¸…æ™°ï¼Œç»§ç»­åŠ æ²¹ï¼</p>
        </div>

        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-gray-600 text-sm">å‘éŸ³å‡†ç¡®åº¦</span>
            <div class="flex items-center space-x-2">
              <div class="w-20 bg-gray-200 rounded-full h-2">
                <div class="bg-green-500 h-2 rounded-full w-4/5"></div>
              </div>
              <span class="text-green-600 font-medium text-sm">82%</span>
            </div>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-gray-600 text-sm">è¯­éŸ³æµç•…åº¦</span>
            <div class="flex items-center space-x-2">
              <div class="w-20 bg-gray-200 rounded-full h-2">
                <div class="bg-blue-500 h-2 rounded-full w-full"></div>
              </div>
              <span class="text-blue-600 font-medium text-sm">90%</span>
            </div>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-gray-600 text-sm">è¯­é€Ÿæ§åˆ¶</span>
            <div class="flex items-center space-x-2">
              <div class="w-20 bg-gray-200 rounded-full h-2">
                <div class="bg-orange-500 h-2 rounded-full w-3/4"></div>
              </div>
              <span class="text-orange-600 font-medium text-sm">75%</span>
            </div>
          </div>
        </div>

        <div class="flex space-x-3 mt-4">
          <button class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-medium text-sm">
            <i class="fas fa-redo mr-1"></i>é‡æ–°ç»ƒä¹ 
          </button>
          <button class="flex-1 bg-orange-500 text-white py-3 rounded-xl font-medium text-sm">
            <i class="fas fa-save mr-1"></i>ä¿å­˜è®°å½•
          </button>
        </div>
      </div>

      <!-- å­¦ä¹ å»ºè®® -->
      <div class="bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl p-6 text-white mb-6">
        <h3 class="text-lg font-semibold mb-3">ğŸ’¡ å­¦ä¹ å»ºè®®</h3>
        <p class="text-blue-100 text-sm mb-3">
          ä½ çš„å‘éŸ³å‡†ç¡®åº¦å¾ˆé«˜ï¼å»ºè®®å¤šç»ƒä¹ ä¸€äº›å¤æ‚çš„å¥å­ï¼Œæå‡è¯­é€Ÿæ§åˆ¶èƒ½åŠ›ã€‚
        </p>
        <button class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg text-sm">
          ç»§ç»­ç»ƒä¹ 
        </button>
      </div>

    </div>


    <!-- æ‹ç…§é€‰é¡¹åŠ¨ä½œè¡¨å• -->
    <div id="actionSheet" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
      <div class="absolute inset-x-0 bottom-0 bg-white rounded-t-2xl">
        <div class="p-4">
          <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
          <div class="space-y-3">
            <button
              onclick="selectFromCamera()"
              class="w-full flex items-center space-x-3 p-4 hover:bg-gray-50 rounded-lg transition-colors"
            >
              <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-camera text-orange-500"></i>
              </div>
              <div class="text-left">
                <div class="font-medium text-gray-800">æ‹ç…§</div>
                <div class="text-sm text-gray-500">ä½¿ç”¨ç›¸æœºæ‹æ‘„æ–°ç…§ç‰‡</div>
              </div>
            </button>
            <button
              onclick="selectFromAlbum()"
              class="w-full flex items-center space-x-3 p-4 hover:bg-gray-50 rounded-lg transition-colors"
            >
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-image text-blue-500"></i>
              </div>
              <div class="text-left">
                <div class="font-medium text-gray-800">ä»ç›¸å†Œé€‰æ‹©</div>
                <div class="text-sm text-gray-500">ä»æ‰‹æœºç›¸å†Œä¸­é€‰æ‹©å›¾ç‰‡</div>
              </div>
            </button>
          </div>
          <button
            onclick="hideActionSheet()"
            class="w-full mt-4 p-3 bg-gray-100 rounded-lg font-medium text-gray-700"
          >
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <script>
      let longPressTimer;
      const translations = {
        standard: "è¿™æ˜¯ä¸€å®¶æ¸©é¦¨çš„å’–å•¡åº—ï¼Œæœ‰ç€æ¸©æš–çš„ç¯å…‰å’Œèˆ’é€‚çš„åº§æ¤…ã€‚å‡ ä½é¡¾å®¢ä¸€è¾¹äº«å—ç€é¥®å“ï¼Œä¸€è¾¹ç”¨ç¬”è®°æœ¬ç”µè„‘å·¥ä½œæˆ–ä¸æœ‹å‹èŠå¤©ã€‚æŸœå°åçš„å’–å•¡å¸ˆæ­£åœ¨åˆ¶ä½œæ–°é²œå’–å•¡ï¼Œé¦™æ°”å¼¥æ¼«æ•´ä¸ªç©ºé—´ã€‚å¤§çª—æˆ·è®©è‡ªç„¶å…‰æ´’è¿›æ¥ï¼Œè¥é€ å‡ºéå¸¸é€‚åˆæ”¾æ¾æˆ–å·¥ä½œçš„æ¸©é¦¨æ°›å›´ã€‚",
        native: "å¤šä¹ˆå¯çˆ±çš„å°å’–å•¡å…å•Šï¼è¿™é‡Œçš„æ°›å›´å¾ˆè½»æ¾ï¼Œæœ‰æŸ”å’Œçš„ç¯å…‰å’Œèˆ’é€‚çš„æ¤…å­ã€‚ä½ å¯ä»¥çœ‹åˆ°äººä»¬åˆ†æ•£åç€â€”â€”æœ‰äº›äººåœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šå¿™ç¢Œï¼Œå…¶ä»–äººåªæ˜¯é—²é€›ï¼Œè¾¹å–å’–å•¡è¾¹èŠå¤©ã€‚å’–å•¡å¸ˆåœ¨æŸœå°åé¢æ–½å±•é­”æ³•ï¼Œå¤©å“ªï¼Œé‚£å’–å•¡é¦™å‘³å¤ªæ£’äº†ï¼é‚£äº›å¤§çª—æˆ·çœŸçš„ç…§äº®äº†è¿™ä¸ªåœ°æ–¹â€”â€”è¿™æ˜¯å·¥ä½œæˆ–æ”¾æ¾çš„å®Œç¾åœºæ‰€ã€‚"
      };

      function handleGenerateStory() {
        const usage = checkUsage('photo')
        if (usage.canUse) {
          incrementUsage('photo')
          const remaining = isMember() ? 'âˆ' : usage.remaining - 1
          alert(
            `ç”Ÿæˆæè¿°æˆåŠŸï¼\n\næ ‡å‡†çŸ­æ–‡å’Œåœ°é“çŸ­æ–‡å·²ç”Ÿæˆï¼Œé•¿æŒ‰æ–‡æœ¬å¯æŸ¥çœ‹ç¿»è¯‘ã€‚\n\nä»Šæ—¥å‰©ä½™å…è´¹æ¬¡æ•°: ${remaining}`,
          )
          // åœ¨è¿™é‡Œå¯ä»¥æ˜¾ç¤ºç”Ÿæˆçš„å†…å®¹
        } else {
          showMembershipPrompt('ä»Šæ—¥æ‹ç…§çŸ­æ–‡ç”Ÿæˆæ¬¡æ•°å·²ç”¨å®Œã€‚')
        }
      }

      // é•¿æŒ‰å¤„ç†
      function handleLongPress(event, type) {
        event.preventDefault();
        longPressTimer = setTimeout(() => {
          showContextMenu(event, type);
        }, 500); // 500msé•¿æŒ‰
      }

      function clearLongPress() {
        if (longPressTimer) {
          clearTimeout(longPressTimer);
        }
      }

      // æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•ï¼ˆå¤åˆ¶å’Œç¿»è¯‘æŒ‰é’®ï¼‰
      function showContextMenu(event, type) {
        event.preventDefault();

        // ç§»é™¤å·²å­˜åœ¨çš„èœå•
        const existingMenu = document.querySelector('.context-menu');
        if (existingMenu) {
          existingMenu.remove();
        }

        const menu = document.createElement('div');
        menu.className = 'context-menu fixed bg-white rounded-xl shadow-lg border border-gray-200 z-50 p-2';
        menu.style.top = (event.touches ? event.touches[0].clientY : event.clientY) + 'px';
        menu.style.left = (event.touches ? event.touches[0].clientX : event.clientX) + 'px';
        menu.innerHTML = `
          <div class="flex space-x-2">
            <button onclick="copyText('${type}Text'); removeContextMenu();" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm flex items-center hover:bg-gray-200 transition-colors">
              <i class="fas fa-copy mr-1"></i>å¤åˆ¶
            </button>
            <button onclick="showTranslation('${type}'); removeContextMenu();" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm flex items-center hover:bg-blue-200 transition-colors">
              <i class="fas fa-language mr-1"></i>ç¿»è¯‘
            </button>
          </div>
        `;

        document.body.appendChild(menu);

        // è°ƒæ•´ä½ç½®ç¡®ä¿ä¸è¶…å‡ºå±å¹•
        const rect = menu.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
          menu.style.left = (window.innerWidth - rect.width - 10) + 'px';
        }
        if (rect.bottom > window.innerHeight) {
          menu.style.top = (window.innerHeight - rect.height - 10) + 'px';
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
        setTimeout(() => {
          document.addEventListener('click', removeContextMenu, { once: true });
          document.addEventListener('touchstart', removeContextMenu, { once: true });
        }, 100);
      }

      function removeContextMenu() {
        const menu = document.querySelector('.context-menu');
        if (menu) {
          menu.remove();
        }
      }

      // æ˜¾ç¤ºç¿»è¯‘
      function showTranslation(type) {
        const translation = translations[type];
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="bg-white rounded-2xl p-6 max-w-sm w-full max-h-96 overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold text-gray-800">${type === 'standard' ? 'æ ‡å‡†çŸ­æ–‡' : 'åœ°é“çŸ­æ–‡'}ç¿»è¯‘</h3>
              <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <p class="text-gray-800 leading-relaxed text-sm">${translation}</p>
            </div>
            <button onclick="copyTranslation('${translation}')" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm w-full">
              <i class="fas fa-copy mr-1"></i>å¤åˆ¶ç¿»è¯‘
            </button>
          </div>
        `;
        document.body.appendChild(modal);

        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.remove();
          }
        });
      }

      // å¤åˆ¶æ–‡æœ¬
      function copyText(elementId) {
        const text = document.getElementById(elementId).textContent;
        navigator.clipboard.writeText(text).then(() => {
          alert('æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(() => {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        });
      }

      // å¤åˆ¶ç¿»è¯‘
      function copyTranslation(text) {
        navigator.clipboard.writeText(text).then(() => {
          alert('ç¿»è¯‘å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(() => {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        });
      }

      // æ’­æ”¾éŸ³é¢‘
      function playAudio(type) {
        alert(`æ­£åœ¨æ’­æ”¾${type === 'standard' ? 'æ ‡å‡†' : 'åœ°é“'}çŸ­æ–‡è¯­éŸ³...`);
        // è¿™é‡Œå¯ä»¥é›†æˆçœŸå®çš„TTS API
      }

      // æ˜¾ç¤ºæ‹ç…§é€‰é¡¹åŠ¨ä½œè¡¨å•
      function showActionSheet() {
        document.getElementById('actionSheet').classList.remove('hidden')
      }

      // éšè—æ‹ç…§é€‰é¡¹åŠ¨ä½œè¡¨å•
      function hideActionSheet() {
        document.getElementById('actionSheet').classList.add('hidden')
      }

      // ä»ç›¸æœºæ‹ç…§
      function selectFromCamera() {
        hideActionSheet()
        alert('æ­£åœ¨æ‰“å¼€ç›¸æœº...')
        // åœ¨è¿™é‡Œå¯ä»¥è°ƒç”¨ç›¸æœºAPI
      }

      // ä»ç›¸å†Œé€‰æ‹©
      function selectFromAlbum() {
        hideActionSheet()
        alert('æ­£åœ¨æ‰“å¼€ç›¸å†Œ...')
        // åœ¨è¿™é‡Œå¯ä»¥è°ƒç”¨ç›¸å†Œé€‰æ‹©API
      }

      // æ”¶è—åŠŸèƒ½
      let favorites = JSON.parse(localStorage.getItem('photoStoryFavorites') || '[]');

      function toggleFavorite(type) {
        const btn = document.getElementById(`favoriteBtn-${type}`);
        const icon = btn.querySelector('i');
        const text = btn.querySelector('span') || btn.childNodes[btn.childNodes.length - 1];
        const textElement = document.getElementById(`${type}Text`);
        const content = textElement.textContent;

        const favoriteItem = {
          id: Date.now(),
          type: type,
          content: content,
          translation: translations[type],
          timestamp: new Date().toISOString()
        };

        const existingIndex = favorites.findIndex(fav => fav.content === content);

        if (existingIndex === -1) {
          // æ·»åŠ æ”¶è—
          favorites.push(favoriteItem);
          icon.className = 'fas fa-heart mr-1';
          btn.className = 'bg-red-500 text-white px-3 py-2 rounded-lg text-sm flex items-center';
          if (text.nodeType === Node.TEXT_NODE) {
            text.textContent = 'å·²æ”¶è—';
          } else {
            text.textContent = 'å·²æ”¶è—';
          }
        } else {
          // å–æ¶ˆæ”¶è—
          favorites.splice(existingIndex, 1);
          icon.className = 'far fa-heart mr-1';
          btn.className = 'bg-red-100 text-red-600 px-3 py-2 rounded-lg text-sm flex items-center';
          if (text.nodeType === Node.TEXT_NODE) {
            text.textContent = 'æ”¶è—';
          } else {
            text.textContent = 'æ”¶è—';
          }
        }

        localStorage.setItem('photoStoryFavorites', JSON.stringify(favorites));
      }

      // è·Ÿè¯»åŠŸèƒ½
      function startFollowReading(type) {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="bg-white rounded-2xl p-6 max-w-sm w-full">
            <div class="text-center mb-6">
              <h3 class="font-semibold text-gray-800 text-lg mb-2">è·Ÿè¯»ç»ƒä¹ </h3>
              <p class="text-gray-600 text-sm">è¯·è·Ÿç€éŸ³é¢‘æœ—è¯»ä»¥ä¸‹å†…å®¹</p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 mb-6">
              <p class="text-gray-800 leading-relaxed text-sm" id="followReadingText">
                ${document.getElementById(type + 'Text').textContent}
              </p>
            </div>

            <div class="space-y-4">
              <button onclick="playFollowReadingAudio('${type}')" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                <i class="fas fa-play mr-2"></i>æ’­æ”¾ç¤ºèŒƒéŸ³é¢‘
              </button>

              <button onclick="startRecording('${type}')" id="recordBtn" class="w-full bg-green-500 text-white py-3 rounded-lg font-medium flex items-center justify-center">
                <i class="fas fa-microphone mr-2"></i>å¼€å§‹å½•éŸ³è·Ÿè¯»
              </button>
            </div>

            <div id="recordingResult" class="hidden mt-4 bg-blue-50 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold text-blue-700">å‘éŸ³è¯„åˆ†</span>
                <div class="flex items-center space-x-2">
                  <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <span class="text-lg font-bold text-green-600" id="scoreDisplay">88</span>
                  </div>
                </div>
              </div>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">å‘éŸ³å‡†ç¡®åº¦:</span>
                  <span class="text-green-600 font-medium">85%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">è¯­éŸ³æµç•…åº¦:</span>
                  <span class="text-blue-600 font-medium">90%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">è¯­é€Ÿæ§åˆ¶:</span>
                  <span class="text-orange-600 font-medium">88%</span>
                </div>
              </div>
            </div>

            <div class="flex space-x-3 mt-6">
              <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium">
                å…³é—­
              </button>
              <button onclick="retryFollowReading('${type}')" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-medium">
                é‡æ–°ç»ƒä¹ 
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
      }

      function playFollowReadingAudio(type) {
        alert(`æ­£åœ¨æ’­æ”¾${type === 'standard' ? 'æ ‡å‡†' : 'åœ°é“'}çŸ­æ–‡ç¤ºèŒƒéŸ³é¢‘...`);
        // è¿™é‡Œå¯ä»¥é›†æˆçœŸå®çš„TTS API
      }

      function startRecording(type) {
        const recordBtn = document.getElementById('recordBtn');
        recordBtn.innerHTML = '<i class="fas fa-stop mr-2"></i>åœæ­¢å½•éŸ³';
        recordBtn.className = 'w-full bg-red-500 text-white py-3 rounded-lg font-medium flex items-center justify-center';
        recordBtn.onclick = () => stopRecording(type);

        // æ¨¡æ‹Ÿå½•éŸ³è¿‡ç¨‹
        setTimeout(() => {
          stopRecording(type);
        }, 3000);
      }

      function stopRecording(type) {
        const recordBtn = document.getElementById('recordBtn');
        recordBtn.innerHTML = '<i class="fas fa-microphone mr-2"></i>å¼€å§‹å½•éŸ³è·Ÿè¯»';
        recordBtn.className = 'w-full bg-green-500 text-white py-3 rounded-lg font-medium flex items-center justify-center';
        recordBtn.onclick = () => startRecording(type);

        // æ˜¾ç¤ºè¯„åˆ†ç»“æœ
        const resultDiv = document.getElementById('recordingResult');
        resultDiv.classList.remove('hidden');

        // éšæœºç”Ÿæˆè¯„åˆ†ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šæ˜¯AIè¯„åˆ†ç»“æœï¼‰
        const score = Math.floor(Math.random() * 20 + 80);
        document.getElementById('scoreDisplay').textContent = score;
      }

      function retryFollowReading(type) {
        const resultDiv = document.getElementById('recordingResult');
        resultDiv.classList.add('hidden');
        startRecording(type);
      }

      // ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
      document.getElementById('actionSheet').addEventListener('click', function(e) {
        if (e.target === this) {
          hideActionSheet()
        }
      })
    </script>
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="bg-white border-t border-gray-200">
      <div class="flex justify-around items-center py-2 px-4">
        <div class="flex flex-col items-center py-2" onclick="window.location.href='home.html'">
          <i class="fas fa-home text-gray-400 text-xl"></i>
          <span class="text-xs text-gray-400 mt-1">é¦–é¡µ</span>
        </div>
        <div class="flex flex-col items-center py-2" onclick="window.location.href='progress.html'">
          <i class="fas fa-chart-line text-gray-400 text-xl"></i>
          <span class="text-xs text-gray-400 mt-1">è¿›åº¦</span>
        </div>
        <div class="flex flex-col items-center py-2" onclick="window.location.href='profile.html'">
          <i class="fas fa-user text-gray-400 text-xl"></i>
          <span class="text-xs text-gray-400 mt-1">æˆ‘çš„</span>
        </div>
      </div>
    </div>
  </body>
</html>
