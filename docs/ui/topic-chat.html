<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å’–å•¡è¯é¢˜å¯¹è¯ - å¼€å£é¸­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .scroll-container::-webkit-scrollbar {
        width: 4px;
      }
      .scroll-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .scroll-container::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 2px;
      }
    </style>
  </head>
  <body class="bg-gray-50 h-screen flex flex-col">
    <!-- Top fixed header section -->
    <div class="flex-shrink-0">
      <!-- iOSçŠ¶æ€æ  -->
      <div class="bg-white h-11 flex items-center justify-between px-4 text-sm font-medium">
        <div class="flex items-center space-x-1">
          <span>9:41</span>
        </div>
        <div class="w-16 h-4 bg-black rounded-full relative">
          <div class="absolute right-0 top-0 w-1 h-1 bg-white rounded-full m-1"></div>
        </div>
        <div class="flex items-center space-x-1">
          <i class="fas fa-signal text-xs"></i>
          <i class="fas fa-wifi text-xs"></i>
          <i class="fas fa-battery-three-quarters text-xs"></i>
        </div>
      </div>

      <!-- å¯¼èˆªæ  -->
      <div class="bg-orange-500 text-white px-4 py-3 flex items-center">
        <i class="fas fa-arrow-left text-xl mr-4"></i>
        <div class="flex items-center flex-1">
          <i class="fas fa-coffee text-xl mr-2"></i>
          <div>
            <h2 class="text-lg font-semibold">å’–å•¡è¯é¢˜</h2>
            <p class="text-xs opacity-80">å¯¹è¯ 3/15</p>
          </div>
        </div>
        <i class="fas fa-bookmark text-xl"></i>
      </div>

      <!-- è¿›åº¦æ¡ -->
      <div class="bg-white px-4 py-2">
        <div class="flex items-center space-x-3">
          <span class="text-sm text-gray-600">è¿›åº¦</span>
          <div class="flex-1 bg-gray-200 rounded-full h-2">
            <div class="bg-orange-500 h-2 rounded-full w-1/5"></div>
          </div>
          <span class="text-sm text-orange-500 font-medium">20%</span>
        </div>
      </div>
    </div>

    <!-- Scrollable main content -->
    <div class="flex-grow overflow-y-auto scroll-container">
      <!-- Added pb-32 to account for the height of the two fixed bottom bars -->
      <div class="px-4 py-4 space-y-4 pb-32">
        <!-- åœºæ™¯æè¿° -->
        <div class="bg-orange-50 rounded-2xl p-4 border border-orange-100">
          <div class="flex items-center space-x-2 mb-2">
            <i class="fas fa-map-marker-alt text-orange-500"></i>
            <span class="text-orange-700 font-medium text-sm">åœºæ™¯ï¼šæ˜Ÿå·´å…‹å’–å•¡åº—</span>
          </div>
          <p class="text-gray-700 text-sm">
            ä½ æƒ³è¦ç‚¹ä¸€æ¯å’–å•¡ï¼Œå‘æœåŠ¡å‘˜è¯¢é—®æ¨èå¹¶æè¿°ä½ çš„å£å‘³åå¥½ã€‚
          </p>
        </div>

        <!-- æœåŠ¡å‘˜å¯¹è¯ -->
        <div class="bg-white rounded-2xl p-4 shadow-sm">
          <div class="flex items-center space-x-3 mb-3">
            <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center">
              <i class="fas fa-user-tie text-white text-sm"></i>
            </div>
            <span class="font-medium text-gray-800">æœåŠ¡å‘˜</span>
            <button class="ml-auto bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-xs">
              <i class="fas fa-play mr-1"></i>æ’­æ”¾
            </button>
          </div>
          <div class="bg-gray-50 rounded-lg p-3">
            <p class="text-gray-800 font-medium mb-2">
              "Good morning! What can I get for you today?"
            </p>
            <p class="text-gray-600 text-sm">"æ—©ä¸Šå¥½ï¼ä»Šå¤©æˆ‘èƒ½ä¸ºæ‚¨åšäº›ä»€ä¹ˆï¼Ÿ"</p>
          </div>
        </div>

        <!-- ç”¨æˆ·å›ç­”åŒºåŸŸ -->
        <div class="bg-blue-50 rounded-2xl p-4 border-2 border-blue-200 border-dashed" id="userAnswerArea">
          <div class="flex items-center space-x-3 mb-3">
            <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center">
              <span class="text-sm">ğŸ¦†</span>
            </div>
            <span class="font-medium text-gray-800">ä½ çš„å›ç­”</span>
          </div>

          <!-- å‚è€ƒç­”æ¡ˆ -->
          <div class="bg-white rounded-lg p-3 mb-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-blue-600">å‚è€ƒç­”æ¡ˆ</span>
              <button class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs" onclick="toggleReferenceAnswer()">
                <i class="fas fa-eye mr-1"></i><span id="referenceToggleText">æŸ¥çœ‹</span>
              </button>
            </div>
            <div id="referenceAnswer" class="hidden transition-all duration-300">
              <p class="text-gray-800 font-medium mb-1">
                "Hi! I'd like a coffee, please. What do you recommend for someone who likes mild flavors?"
              </p>
              <p class="text-gray-600 text-sm">
                "ä½ å¥½ï¼æˆ‘æƒ³è¦ä¸€æ¯å’–å•¡ã€‚å¯¹äºå–œæ¬¢æ¸©å’Œå£å‘³çš„äººï¼Œä½ æ¨èä»€ä¹ˆï¼Ÿ"
              </p>
            </div>
          </div>

          <!-- ç”¨æˆ·å½•éŸ³å†…å®¹ -->
          <div id="userRecording" class="bg-white rounded-lg p-3 mb-3 hidden">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-green-600">ä½ çš„å›ç­”</span>
              <div class="flex items-center space-x-2">
                <button class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs" onclick="playUserRecording()">
                  <i class="fas fa-play mr-1"></i>æ’­æ”¾
                </button>
                <button class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs" onclick="retryRecording()">
                  <i class="fas fa-redo mr-1"></i>é‡æ–°å½•éŸ³
                </button>
              </div>
            </div>
            <div id="userRecordingContent">
              <!-- å½•éŸ³å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
          </div>

          <!-- è·Ÿè¯»æŒ‰é’® -->
          <div class="text-center">
            <button
              id="recordButton"
              class="bg-blue-500 text-white px-6 py-2 rounded-full flex items-center space-x-2 mx-auto active:scale-95 transition-all duration-200"
              onmousedown="startRecording()"
              onmouseup="stopRecording()"
              onmouseleave="stopRecording()"
              ontouchstart="startRecording()"
              ontouchend="stopRecording()"
            >
              <i id="recordIcon" class="fas fa-microphone text-lg"></i>
              <span id="recordText" class="font-medium">å¼€å§‹è·Ÿè¯»</span>
            </button>
            <p class="text-xs text-gray-500 mt-2">é•¿æŒ‰å½•éŸ³ï¼Œæ¾å¼€ç»“æŸ</p>
          </div>
        </div>

        <!-- ç³»ç»Ÿè‡ªåŠ¨å›å¤åŒºåŸŸ -->
        <div id="systemReply" class="bg-orange-50 rounded-2xl p-4 border border-orange-200 hidden">
          <div class="flex items-center space-x-3 mb-3">
            <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center">
              <i class="fas fa-user-tie text-white text-sm"></i>
            </div>
            <span class="font-medium text-gray-800">æœåŠ¡å‘˜å›å¤</span>
            <button class="ml-auto bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-xs" onclick="playSystemReply()">
              <i class="fas fa-play mr-1"></i>æ’­æ”¾
            </button>
          </div>
          <div id="systemReplyContent" class="bg-white rounded-lg p-3">
            <!-- ç³»ç»Ÿå›å¤å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
          </div>
        </div>

        <!-- å¯¹è¯å®Œæˆæç¤º -->
        <div id="dialogueComplete" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-4 border border-green-200 text-center hidden">
          <div class="text-2xl mb-2">ğŸ‰</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">å¤ªæ£’äº†ï¼</h3>
          <p class="text-gray-600 text-sm mb-4">ä½ å·²ç»å®Œæˆäº†è¿™è½®å¯¹è¯ï¼Œè¡¨ç°å¾ˆä¸é”™ï¼</p>
          <button class="bg-green-500 text-white px-6 py-2 rounded-full font-medium" onclick="nextDialogue()">
            <i class="fas fa-arrow-right mr-2"></i>ç»§ç»­ä¸‹ä¸€ä¸ªå¯¹è¯
          </button>
        </div>

        <!-- è¯­éŸ³è¯„åˆ†ç»“æœ -->
        <div id="scoreResult" class="bg-green-50 rounded-2xl p-4 border border-green-200 hidden">
          <div class="flex items-center space-x-3 mb-3">
            <i class="fas fa-chart-line text-green-500 text-lg"></i>
            <span class="font-medium text-gray-800">è¯­éŸ³è¯„åˆ†</span>
          </div>

          <div class="space-y-3">
            <!-- æ€»åˆ† -->
            <div class="flex items-center justify-between">
              <span class="text-gray-700">æ€»ä½“è¯„åˆ†</span>
              <div class="flex items-center space-x-2">
                <div class="flex space-x-1">
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="far fa-star text-gray-300"></i>
                </div>
                <span class="text-green-600 font-bold text-lg">85åˆ†</span>
              </div>
            </div>

            <!-- è¯¦ç»†è¯„åˆ† -->
            <div class="space-y-2">
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">å‘éŸ³å‡†ç¡®åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full w-4/5"></div>
                  </div>
                  <span class="text-green-600 font-medium">80%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">è¯­éŸ³æµç•…åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-500 h-2 rounded-full w-full"></div>
                  </div>
                  <span class="text-blue-600 font-medium">90%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">è¯­è°ƒè‡ªç„¶åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-orange-500 h-2 rounded-full w-3/4"></div>
                  </div>
                  <span class="text-orange-600 font-medium">75%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Fixed Footer Wrapper -->
    <div class="fixed bottom-0 left-0 right-0 z-10 flex-shrink-0 bg-white">
      <!-- åº•éƒ¨æ“ä½œåŒºåŸŸ -->
      <div class="px-4 py-3 border-t border-gray-200">
        <div class="flex justify-center space-x-4 max-w-md mx-auto">
          <button
            class="bg-gray-200 text-gray-800 py-3 px-6 rounded-xl font-medium flex items-center"
          >
            <i class="fas fa-redo mr-2"></i>é‡æ–°ç»ƒä¹ 
          </button>
          <button
            class="bg-orange-500 text-white py-3 px-6 rounded-xl font-medium flex items-center"
          >
            <i class="fas fa-arrow-right mr-2"></i>ä¸‹ä¸€ä¸ªå¯¹è¯
          </button>
        </div>
      </div>
      <!-- åº•éƒ¨å¯¼èˆªæ  -->
      <div class="border-t border-gray-200">
        <div class="flex justify-around items-center py-2 px-4">
          <div class="flex flex-col items-center py-2" onclick="window.location.href='home.html'">
            <i class="fas fa-home text-gray-400 text-xl"></i>
            <span class="text-xs text-gray-400 mt-1">é¦–é¡µ</span>
          </div>
          <div
            class="flex flex-col items-center py-2"
            onclick="window.location.href='progress.html'"
          >
            <i class="fas fa-chart-line text-gray-400 text-xl"></i>
            <span class="text-xs text-gray-400 mt-1">è¿›åº¦</span>
          </div>
          <div
            class="flex flex-col items-center py-2"
            onclick="window.location.href='profile.html'"
          >
            <i class="fas fa-user text-gray-400 text-xl"></i>
            <span class="text-xs text-gray-400 mt-1">æˆ‘çš„</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // å…¨å±€å˜é‡
      let isRecording = false;
      let recordingTimer = null;
      let audioStream = null;
      let isReferenceAnswerVisible = false;
      let hasUserAnswered = false;

      // æ¨¡æ‹Ÿå¯¹è¯æ•°æ®
      const dialogueData = {
        systemReplies: [
          {
            english: "Great choice! For mild flavors, I'd recommend our medium roast or maybe a caramel macchiato. Would you like to try one of those?",
            chinese: "å¾ˆå¥½çš„é€‰æ‹©ï¼å¯¹äºæ¸©å’Œçš„å£å‘³ï¼Œæˆ‘æ¨èæˆ‘ä»¬çš„ä¸­åº¦çƒ˜ç„™å’–å•¡æˆ–è€…ç„¦ç³–ç›å¥‡æœµã€‚ä½ æƒ³è¯•è¯•å…¶ä¸­ä¸€ç§å—ï¼Ÿ"
          },
          {
            english: "Perfect! The caramel macchiato is very popular. What size would you like - small, medium, or large?",
            chinese: "å¤ªå¥½äº†ï¼ç„¦ç³–ç›å¥‡æœµå¾ˆå—æ¬¢è¿ã€‚æ‚¨è¦ä»€ä¹ˆå°ºå¯¸çš„ - å°æ¯ã€ä¸­æ¯è¿˜æ˜¯å¤§æ¯ï¼Ÿ"
          }
        ],
        currentReply: 0
      };

      // å‚è€ƒç­”æ¡ˆåˆ‡æ¢åŠŸèƒ½
      function toggleReferenceAnswer() {
        const referenceAnswer = document.getElementById('referenceAnswer');
        const toggleText = document.getElementById('referenceToggleText');
        const icon = toggleText.previousElementSibling;

        if (isReferenceAnswerVisible) {
          referenceAnswer.classList.add('hidden');
          toggleText.textContent = 'æŸ¥çœ‹';
          icon.className = 'fas fa-eye mr-1';
          isReferenceAnswerVisible = false;
        } else {
          referenceAnswer.classList.remove('hidden');
          toggleText.textContent = 'éšè—';
          icon.className = 'fas fa-eye-slash mr-1';
          isReferenceAnswerVisible = true;
        }
      }

      // å¼€å§‹å½•éŸ³
      function startRecording() {
        if (isRecording) return;

        isRecording = true;
        const recordButton = document.getElementById('recordButton');
        const recordIcon = document.getElementById('recordIcon');
        const recordText = document.getElementById('recordText');

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        recordButton.classList.remove('bg-blue-500');
        recordButton.classList.add('bg-red-500', 'animate-pulse');
        recordIcon.className = 'fas fa-stop text-lg';
        recordText.textContent = 'å½•éŸ³ä¸­...';

        // æ¨¡æ‹Ÿå½•éŸ³å¼€å§‹
        console.log('å¼€å§‹å½•éŸ³...');

        // å¯åŠ¨å½•éŸ³è®¡æ—¶å™¨
        let recordTime = 0;
        recordingTimer = setInterval(() => {
          recordTime++;
          recordText.textContent = `å½•éŸ³ä¸­... ${recordTime}s`;
        }, 1000);

        // æ¨¡æ‹Ÿè·å–éº¦å…‹é£æƒé™å¹¶å¼€å§‹å½•éŸ³
        navigator.mediaDevices?.getUserMedia({ audio: true })
          .then(stream => {
            audioStream = stream;
          })
          .catch(err => {
            console.log('éº¦å…‹é£æƒé™è·å–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå½•éŸ³');
          });
      }

      // åœæ­¢å½•éŸ³
      function stopRecording() {
        if (!isRecording) return;

        isRecording = false;

        // æ¸…é™¤è®¡æ—¶å™¨
        if (recordingTimer) {
          clearInterval(recordingTimer);
          recordingTimer = null;
        }

        // åœæ­¢éŸ³é¢‘æµ
        if (audioStream) {
          audioStream.getTracks().forEach(track => track.stop());
          audioStream = null;
        }

        // æ¢å¤æŒ‰é’®çŠ¶æ€
        const recordButton = document.getElementById('recordButton');
        const recordIcon = document.getElementById('recordIcon');
        const recordText = document.getElementById('recordText');

        recordButton.classList.remove('bg-red-500', 'animate-pulse');
        recordButton.classList.add('bg-blue-500');
        recordIcon.className = 'fas fa-microphone text-lg';
        recordText.textContent = 'å¼€å§‹è·Ÿè¯»';

        // å¤„ç†å½•éŸ³ç»“æœ
        processRecordingResult();
      }

      // å¤„ç†å½•éŸ³ç»“æœ
      function processRecordingResult() {
        console.log('å¤„ç†å½•éŸ³ç»“æœ...');

        // æ˜¾ç¤ºå½•éŸ³ç»“æœ
        showUserRecording();

        // å»¶è¿Ÿæ˜¾ç¤ºç³»ç»Ÿå›å¤
        setTimeout(() => {
          showSystemReply();
        }, 2000);
      }

      // æ˜¾ç¤ºç”¨æˆ·å½•éŸ³ç»“æœ
      function showUserRecording() {
        const userRecording = document.getElementById('userRecording');
        const userRecordingContent = document.getElementById('userRecordingContent');

        // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«å’Œç¿»è¯‘ç»“æœ
        const simulatedResult = {
          english: "Hi! I'd like a coffee please. What do you recommend for mild flavors?",
          chinese: "ä½ å¥½ï¼æˆ‘æƒ³è¦ä¸€æ¯å’–å•¡ã€‚å¯¹äºæ¸©å’Œå£å‘³ä½ æ¨èä»€ä¹ˆï¼Ÿ",
          confidence: 0.85
        };

        userRecordingContent.innerHTML = `
          <p class="text-gray-800 font-medium mb-1">"${simulatedResult.english}"</p>
          <p class="text-gray-600 text-sm mb-2">"${simulatedResult.chinese}"</p>
          <div class="flex items-center justify-between text-xs">
            <span class="text-green-600">è¯†åˆ«å‡†ç¡®åº¦: ${Math.round(simulatedResult.confidence * 100)}%</span>
            <div class="flex items-center space-x-1">
              <i class="fas fa-star text-yellow-400"></i>
              <span class="text-gray-600">å‘éŸ³è¯„åˆ†: 85åˆ†</span>
            </div>
          </div>
        `;

        userRecording.classList.remove('hidden');
        hasUserAnswered = true;

        // æ˜¾ç¤ºè¯„åˆ†ç»“æœ
        showScoreResult();
      }

      // æ˜¾ç¤ºè¯­éŸ³è¯„åˆ†ç»“æœ
      function showScoreResult() {
        const scoreResult = document.getElementById('scoreResult');
        scoreResult.innerHTML = `
          <div class="flex items-center space-x-3 mb-3">
            <i class="fas fa-chart-line text-green-500 text-lg"></i>
            <span class="font-medium text-gray-800">è¯­éŸ³è¯„åˆ†</span>
          </div>
          <div class="space-y-3">
            <!-- æ€»åˆ† -->
            <div class="flex items-center justify-between">
              <span class="text-gray-700">æ€»ä½“è¯„åˆ†</span>
              <div class="flex items-center space-x-2">
                <div class="flex space-x-1">
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="fas fa-star text-yellow-400"></i>
                  <i class="far fa-star text-gray-300"></i>
                </div>
                <span class="text-green-600 font-bold text-lg">85åˆ†</span>
              </div>
            </div>
            <!-- è¯¦ç»†è¯„åˆ† -->
            <div class="space-y-2">
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">å‘éŸ³å‡†ç¡®åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full w-4/5"></div>
                  </div>
                  <span class="text-green-600 font-medium">80%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">è¯­éŸ³æµç•…åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-500 h-2 rounded-full w-full"></div>
                  </div>
                  <span class="text-blue-600 font-medium">90%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">è¯­è°ƒè‡ªç„¶åº¦</span>
                <div class="flex items-center space-x-2">
                  <div class="w-16 bg-gray-200 rounded-full h-2">
                    <div class="bg-orange-500 h-2 rounded-full w-3/4"></div>
                  </div>
                  <span class="text-orange-600 font-medium">75%</span>
                </div>
              </div>
            </div>
          </div>
        `;
        scoreResult.classList.remove('hidden');
      }

      // æ˜¾ç¤ºç³»ç»Ÿå›å¤
      function showSystemReply() {
        if (!hasUserAnswered) return;

        const systemReply = document.getElementById('systemReply');
        const systemReplyContent = document.getElementById('systemReplyContent');
        const currentReplyData = dialogueData.systemReplies[dialogueData.currentReply];

        systemReplyContent.innerHTML = `
          <p class="text-gray-800 font-medium mb-2">"${currentReplyData.english}"</p>
          <p class="text-gray-600 text-sm">"${currentReplyData.chinese}"</p>
        `;

        systemReply.classList.remove('hidden');

        // æ˜¾ç¤ºå¯¹è¯å®Œæˆæç¤º
        setTimeout(() => {
          showDialogueComplete();
        }, 3000);
      }

      // æ˜¾ç¤ºå¯¹è¯å®Œæˆæç¤º
      function showDialogueComplete() {
        const dialogueComplete = document.getElementById('dialogueComplete');
        dialogueComplete.classList.remove('hidden');

        // æ»šåŠ¨åˆ°åº•éƒ¨
        setTimeout(() => {
          dialogueComplete.scrollIntoView({ behavior: 'smooth' });
        }, 100);
      }

      // æ’­æ”¾ç”¨æˆ·å½•éŸ³
      function playUserRecording() {
        // æ¨¡æ‹Ÿæ’­æ”¾ç”¨æˆ·å½•éŸ³
        console.log('æ’­æ”¾ç”¨æˆ·å½•éŸ³...');
        showToast('æ’­æ”¾ç”¨æˆ·å½•éŸ³');
      }

      // æ’­æ”¾ç³»ç»Ÿå›å¤
      function playSystemReply() {
        // æ¨¡æ‹Ÿæ’­æ”¾ç³»ç»Ÿå›å¤
        console.log('æ’­æ”¾ç³»ç»Ÿå›å¤...');
        showToast('æ’­æ”¾ç³»ç»Ÿå›å¤');
      }

      // é‡æ–°å½•éŸ³
      function retryRecording() {
        const userRecording = document.getElementById('userRecording');
        const scoreResult = document.getElementById('scoreResult');
        const systemReply = document.getElementById('systemReply');
        const dialogueComplete = document.getElementById('dialogueComplete');

        // éšè—ç›¸å…³å…ƒç´ 
        userRecording.classList.add('hidden');
        scoreResult.classList.add('hidden');
        systemReply.classList.add('hidden');
        dialogueComplete.classList.add('hidden');

        hasUserAnswered = false;

        showToast('è¯·é‡æ–°å½•éŸ³');
      }

      // ä¸‹ä¸€ä¸ªå¯¹è¯
      function nextDialogue() {
        // å¢åŠ å¯¹è¯ç´¢å¼•
        dialogueData.currentReply = Math.min(dialogueData.currentReply + 1, dialogueData.systemReplies.length - 1);

        // é‡ç½®ç•Œé¢
        resetDialogueInterface();

        // æ›´æ–°è¿›åº¦
        updateProgress();

        showToast('å¼€å§‹ä¸‹ä¸€ä¸ªå¯¹è¯');
      }

      // é‡ç½®å¯¹è¯ç•Œé¢
      function resetDialogueInterface() {
        const userRecording = document.getElementById('userRecording');
        const scoreResult = document.getElementById('scoreResult');
        const systemReply = document.getElementById('systemReply');
        const dialogueComplete = document.getElementById('dialogueComplete');
        const referenceAnswer = document.getElementById('referenceAnswer');
        const toggleText = document.getElementById('referenceToggleText');
        const icon = toggleText.previousElementSibling;

        // éšè—æ‰€æœ‰åŠ¨æ€å…ƒç´ 
        userRecording.classList.add('hidden');
        scoreResult.classList.add('hidden');
        systemReply.classList.add('hidden');
        dialogueComplete.classList.add('hidden');

        // é‡ç½®å‚è€ƒç­”æ¡ˆ
        referenceAnswer.classList.add('hidden');
        toggleText.textContent = 'æŸ¥çœ‹';
        icon.className = 'fas fa-eye mr-1';
        isReferenceAnswerVisible = false;

        hasUserAnswered = false;
      }

      // æ›´æ–°è¿›åº¦
      function updateProgress() {
        const progressBar = document.querySelector('.bg-orange-500');
        const progressText = document.querySelector('.text-orange-500.font-medium');
        const dialogueCount = document.querySelector('.text-xs.opacity-80');

        const currentProgress = Math.min((dialogueData.currentReply + 1) * 20, 100);
        progressBar.style.width = `${currentProgress}%`;
        progressText.textContent = `${currentProgress}%`;
        dialogueCount.textContent = `å¯¹è¯ ${dialogueData.currentReply + 4}/15`;
      }

      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm';
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 2000);
      }

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        console.log('è¯é¢˜å¯¹è¯æ¨¡å—åˆå§‹åŒ–å®Œæˆ');

        // é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶å½•éŸ³ä¸­æ–­
        document.addEventListener('touchmove', function(e) {
          if (isRecording) {
            e.preventDefault();
          }
        }, { passive: false });
      });

      // é˜²æ­¢é»˜è®¤é•¿æŒ‰èœå•
      document.getElementById('recordButton').addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });
    </script>
  </body>
</html>
